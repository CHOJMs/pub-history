<!DOCTYPE html>
<html lang="ko">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<%@ page contentType="text/html; charset=euc-kr" language="java" %>
<title>DGB 캐피탈 관리자</title>
<link type="text/css" rel="stylesheet" href="/static/admin/css/admin.css">

<!-- SecureFrame Start-->

<!-- SecureFrame End-->

<script type="text/javascript" src="/static/admin/js/dgbjquery-1.11.1.js"></script>
<script type="text/javascript" src="/static/admin/js/jquery.easing.js"></script>
<script type="text/javascript" src="/static/admin/js/css_browser_selector.min.js"></script>
<script type="text/javascript" src="/static/admin/js/commonEncode.js"></script>
<script type="text/javascript" src="/static/admin/js/common.js"></script>
<script type="text/javascript" src="/static/admin/js/dsr_common.js"></script>
<script type="text/javascript" src="/static/admin/js/jquery.mCustomScrollbar.concat.min.js"></script>

<%-- START : JAVA로직 구현 --%>
<%
			
%>
<%--   END : JAVA로직 구현 --%>

<%-- START : SCRIPT로직 구현 --%>
<script type="text/javascript">

	// 등록
	function goInsert(){
		var frm  = document.submitForm_imgMgt;
		var sFrm = document.sendMultiptForm;

		var sfileList = sFrm.ATTACH_FILE2.value;

		if(sfileList != "")
		{
			if(sfileList.lastIndexOf(".")== -1)
			{
				alert("등록할수 없는 파일형식입니다.");
				return;
			}
		}

		var sfileList4dup = sfileList.substring(sfileList.lastIndexOf("\\")+1, sfileList.length);
		if('' == $.trim(sfileList4dup)){
			alert('파일을 선택해주세요.');
			return;
		}
		// 동일한 파일 존재여부체크
		var dupChk = '1';
		$('.fileName').each(function(){
			if($(this).val() == sfileList4dup){
				dupChk = '2';
				alert("동일한이름의 파일이 존재합니다.");
			}
		});
		if('2' == dupChk){
			return;
		}
	
		var fileList = sfileList.substring(sfileList.lastIndexOf("\\")+1, sfileList.length);
		sfileList    = sfileList.substring(sfileList.lastIndexOf(".")+1,  sfileList.length);

//		if(sfileList == "" || sfileList == "jpg" || sfileList == "JPG" || sfileList == "JPEG" || sfileList == "gif" || sfileList == "GIF" || sfileList == "png" || sfileList == "PNG"){
		// jsp이미지만 가능
		if(sfileList == "" || sfileList == "jpg"){

		}else{
			alert("jsp형식의 이미지 파일만 가능합니다.");
			return;
		}

		//한글입력체크
		if(ChkHan(fileList) == true)
		{
			alert("이미지명을 협회등록번호로 바꿔주세요.");
			return;
		}

		/* 폼데이타 암호화 전송 */
		sFrm.METHOD.value = "regDsrAdminImgReg";
		sFrm.action = "/admin/AdminDsrAction.do";

		if(EncForm2(frm , sFrm) ){
			today = new Date();
			if(confirm("등록하시겠습니까?")){
				sFrm.submit();
			}
		}else{
			alert( "보안상 문제가 발생하여 전송이 취소 되었습니다." );
		}
	};

	// 파일명 한글체크
	function ChkHan(strValue) {
		for(i=0; i < strValue.length; i++){
			var a = strValue.charCodeAt(i);
			if(a > 128){
				return true;
			}
		}
	}; 
 
	// 이미지 미리보기
	function showPreview(fn) {
		$('#previewImg').prop('src',"/static/admin/img/common/nophoto.gif");
		$('#popPicture2').show();
	};
	
	// 삭제
	function delImage(fn) {
		document.submitForm_imgDel.imageName.value = fn;

		if(confirm("정말 삭제하시겠습니까?") == true){
			sendAjaxAction(document.submitForm_imgDel, document.sendForm, "fAjaxCallBack_delImage", "/admin/AdminDsrAction.do");
		}
	};

	// 삭제callback
	function fAjaxCallBack_delImage(result){
		var INIpluginData = $(result).find("INIpluginData").attr("value");
		var decrypt = Idecrypt(INIpluginData);
		var delResult = $(decrypt).find("isSuccessDel").attr("value");

		if('Y' == delResult){
			alert('삭제하였습니다.');
			EncLinkNormal(gHomePageUrl('09000300'));
		} else {
			alert('삭제에 실패하였습니다.(시스템오류)');
		}
	};

	// 이미지조회
	function searchImage() {
		var srchKey = $('#srchImgId').val();

		if('' == $.trim(srchKey)){
			alert('파일명을 입력하세요.');
			$('#srchImgId').focus();

			return;
		}
		
		var url = '/admin/dgbAdmin008.jsp?METHOD=regDsrAdminImgSrch&menuNo=6&srchImgId='+srchKey;
		location.href=url;
	};

</script>
<%--   END : SCRIPT로직 구현 --%>

</head>



<body>
<form id="submitForm_imgDel" name="submitForm_imgDel"/>
	<input type="hidden" id="imageName" name="imageName" value="" />
	<input type="hidden" id="METHOD"    name="METHOD" value="regDsrAdminImgDel" />
</form>
<form id="submitForm_imgMgt" name="submitForm_imgMgt" method="post" onsubmit="return false;">
	<input type="hidden" name="METHOD" />
	<input type="hidden" name="INIpluginData">
	<input type="hidden" name="LOGIN_SVC"  value="N"/>

	<div class="wrapper">
		<div class="header">
			<jsp:include page="/admin/inc/header_new.jsp" flush="false"> 
				<jsp:param name="menuNo" value="6"/> 
			</jsp:include>
		</div> <!--// header -->

		<div class="contents" style="width:1230px ! important;"> <!-- 개발 참고사항 : 2016-12-21 contents 안에 내용만 사용하세요 -->
			<h2>상담사 사진관리</h2>
			<div class="form-type">
				<table class="data-table form" border="1">
					<colgroup>
						<col width="12%" />
						<col width="" />
					</colgroup>
					<tbody>
					<tr>
						<th class="bg4">파일명</th>
						<td><input type="text" class="wd2" id="srchImgId" name="srchImgId" value="" /></td>
					</tr>
					</tbody>
				</table>
			</div>
			<br />
			<p class="align-right">
				<a href="#" class="btn" onclick="javascript:searchImage();">조회</a>
			</p>
			<br />
			<div class="form-type">
				<table class="data-table form" border="1">
					<caption></caption>
					<colgroup>
						<col width="12%" />
						<col width="" />
						<col width="18%" />
					</colgroup>
					<thead>
					<tr>
						<th scope="col">순번</th>
						<th scope="col">파일명</th>
						<th scope="col">등록/삭제</th>
					</tr>
					</thead>
					<tbody>

					<tr>
						<td>
							1
						</td>
						<td>
							A0001.jpg
						</td>
						<td>
							<a href="#none" class="btn" onclick="javascript:showPreview('A0001.jpg');">보기</a>
							<a href="#none" class="btn" onclick="javascript:delImage('A0001.jpg');">삭제</a>
						</td>
					</tr>

					</tbody>
				</table>
			</div>
			<br />
			<p class="align-right">
				<a href="#1" class="btn h42" onclick="$('#popPicture').show()">등록</a>
			</p>
		</div><!--// contents -->

		<div class="footer">
			<jsp:include page="/admin/inc/footer.jsp" flush="false"></jsp:include>
		</div><!--// footer -->
	</div><!--// wrapper -->
</form>
	<!-- layer -->
<form id="sendMultiptForm" name="sendMultiptForm" method="post" action="/admin/AdminDsrAction.do" enctype="multipart/form-data" >
	<input type="hidden" name="METHOD" />
	<input type="hidden" name="INIpluginData" />
	<input type="hidden" name="LOGIN_SVC"  value="N"/>

	<div class="layerPop_ui" id="popPicture">
		<div class="layer_pop pop_pic">
			<h1>사진등록</h1>
			<div class="cons">
				<table class="tbl_row">
					<caption></caption>
					<colgroup>
						<col width="20%" />
						<col width="" />
					</colgroup>
					<tbody>
					<tr>
						<th>파일찾기</th>
						<td>
							<input type="file" name="ATTACH_FILE2" id="ATTACH_FILE2" class="wd2">&nbsp;<a href="#1" class="btnP01" onClick="javascript:goInsert();">등록</a>
						</td>
					</tr>
					</tbody>
				</table>
				<p class="para01">* 이미지파일(*.jpg)만 등록가능 <br />* 가로세로 사이즈 : 128 * 128</p>
				<p class="btn_g">
					<a href="#1" class="btnP01 close" onclick="$('#ATTACH_FILE2').val('');$('.layerPop_ui').hide()">닫기</a>
				</p>
			</div><!-- //cons -->
		</div>
	</div>
	<!-- //layer -->
	<div class="layerPop_ui" id="popPicture2">
		<div class="layer_pop pop_pic" style="width:170px;height:240px;">
			<div class="cons">
				<img id="previewImg" src="" style="width:128px;height:128px;" />

				<p class="btn_g">
					<a href="#1" class="btnP01 close" onclick="$('.layerPop_ui').hide()">닫기</a>
				</p>
			</div><!-- //cons -->
		</div>
	</div>
</form>


</body>
</html>